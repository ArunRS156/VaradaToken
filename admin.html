<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  background:#F4F6F7;
  margin:0;
}
.header {
  background:#D35400;
  color:white;
  padding:15px;
  text-align:center;
  font-size:20px;
}
.card {
  background:white;
  margin:15px;
  padding:15px;
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}
input, button {
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:6px;
  border:1px solid #ccc;
}
button {
  background:#27AE60;
  color:white;
  font-weight:bold;
  cursor:pointer;
  border:none;
}
button.red {
  background:#E74C3C;
}
table {
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th, td {
  border:1px solid #ddd;
  padding:6px;
  text-align:center;
}
th {
  background:#FAD7A0;
}
.hidden {
  display:none;
}
a {
  color:#2980B9;
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">Project Arun â€“ Admin Panel</div>

<!-- LOGIN -->
<div class="card" id="loginBox">
  <h3>Admin Login</h3>
  <input type="password" id="pw" placeholder="Enter password">
  <button onclick="login()">Login</button>
</div>

<!-- SETTINGS -->
<div class="card hidden" id="settingsBox">
  <h3>Slot Settings</h3>

  <label>Date</label>
  <input type="date" id="sDate">

  <label>Start Time</label>
  <input type="time" id="sTime">

  <label>Duration</label>
  <input type="number" id="sDuration">

  <label>Max Tokens</label>
  <input type="number" id="sLimit">

  <button onclick="saveSettings()">Save Settings</button>
  <button class="red" onclick="logout()">Logout</button>
</div>

<!-- DATA -->
<div class="card hidden" id="dataBox">
  <h3>Registrations</h3>
  <button class="red" onclick="loadData()">ðŸ”„ Refresh</button>

  <div style="overflow-x:auto;margin-top:10px;">
    <table>
      <thead>
        <tr>
          <th>Token</th>
          <th>Timestamp</th>
          <th>Mobile</th>
          <th>Name</th>
          <th>Persons</th>
          <th>District / State</th>
          <th>Place</th>
          <th>Payment Status</th>
          <th>Txn ID</th>
          <th>Screenshot URL</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</div>

<script>
function login() {
  google.script.run.withSuccessHandler(ok => {
    if (!ok) return alert("Wrong password");

    loginBox.classList.add("hidden");
    settingsBox.classList.remove("hidden");
    dataBox.classList.remove("hidden");
    loadData();
  }).checkAdminLogin(pw.value);
}

function logout() {
  location.reload();
}

function saveSettings() {
  const data = {
    date: sDate.value,
    time: sTime.value,
    duration: sDuration.value,
    limit: sLimit.value
  };
  google.script.run.saveSlotSettings(data);
  alert("Settings Saved");
}

function loadData() {
  google.script.run.withSuccessHandler(data => {
    rows.innerHTML = "";

    data.slice(1).forEach(r => {
      const tr = document.createElement("tr");

      r.forEach((cell, i) => {
        const td = document.createElement("td");

        // Screenshot link
        if (i === 9 && cell) {
          td.innerHTML = `<a href="${cell}" target="_blank">View</a>`;
        } else {
          td.textContent = cell || "-";
        }

        tr.appendChild(td);
      });

      rows.appendChild(tr);
    });
  }).getFullData();
}
</script>

</body>
</html>
